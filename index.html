<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Study Buddy Finder</title>
  </head>
  <body>
    <h1>Find Study Buddies</h1>

    <label for="subject">Choose subject:</label>
    <select id="subject">
      <option value="PPS">PPS</option>
      <option value="Chemistry">Chemistry</option>
      <option value="POE">POE</option>
      <option value="Math">Math</option>
    </select>
    <button onclick="showBuddies()">Find</button>

    <ul id="buddyList"></ul>

    <script>
      const sheetURL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vSRI6Fqs56n0SgDT9xFm0_fdU0bNVjVP10Yf-dLM4C7XiAxYOOMuyRsWC-8pPi6KuFcQBKnTlHxwtSA/pub?gid=1707920213&single=true&output=csv";
      const proxyURL =
        "https://api.allorigins.win/raw?url=" + encodeURIComponent(sheetURL);

      async function showBuddies() {
        const subject = document.getElementById("subject").value;
        const list = document.getElementById("buddyList");
        list.innerHTML = "<li>Loading...</li>";

        try {
          const res = await fetch(proxyURL);
          const csvText = await res.text();

          // Parse CSV
          const rows = csvText.split("\n").map((r) => r.split(","));

          // Skip header row (first row)
          const results = rows
            .slice(1)
            .filter((r) => r[2] && r[2].trim() === subject);

          list.innerHTML = "";
          if (results.length === 0) {
            list.innerHTML = "<li>No students found</li>";
          } else {
            results.forEach((r) => {
              const li = document.createElement("li");
              li.textContent = r[1]; // column 2 = Name
              list.appendChild(li);
            });
          }
        } catch (err) {
          console.error(err);
          list.innerHTML = "<li>Error fetching data</li>";
        }
      }
    </script>
  </body>
</html>
